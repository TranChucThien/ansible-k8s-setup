# Kubernetes HAProxy Config

frontend kubernetes-frontend
    bind *:6443
    mode tcp
    option tcplog
    default_backend kubernetes-backend

backend kubernetes-backend
    mode tcp
    balance roundrobin
    option tcp-check

    {% for host in groups['masters'] %}
    server master{{ loop.index }} {{ host }}:6443 check
    {% endfor %}

# HAProxy Stats Page
listen stats
    bind *:8404
    mode http
    stats enable
    stats uri /
    stats refresh 5s