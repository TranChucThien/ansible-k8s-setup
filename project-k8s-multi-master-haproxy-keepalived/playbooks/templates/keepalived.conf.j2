# Keepalived Configuration for HAProxy High Availability
# Generated by Ansible - DO NOT EDIT MANUALLY

# Health check script for HAProxy
vrrp_script check_haproxy {
    script "/usr/bin/pgrep haproxy"
    interval 2
    weight 10
}

# VRRP instance configuration
vrrp_instance VI_1 {
{% if inventory_hostname == groups['ha'][0] %}
    state MASTER
    priority 100
{% else %}
    state BACKUP
    priority {{ 100 - (groups['ha'].index(inventory_hostname) * 10) }}
{% endif %}
    interface {{ network_interface }}
    virtual_router_id {{ virtual_router_id }}
    advert_int 1

{% if keepalived_auth_enabled | default(true) %}
    authentication {
        auth_type PASS
        auth_pass {{ keepalived_password }}
    }
{% endif %}

    virtual_ipaddress {
        {{ vip_address }}/{{ vip_netmask }}
    }

    track_script {
        check_haproxy
    }
}
